<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin — Reviews</title>
  <style>
    body{font-family:system-ui; max-width:900px; margin:20px auto; padding:0 14px;}
    input, textarea, button{width:100%; padding:10px; margin:6px 0;}
    .row{border:1px solid #ddd; padding:12px; border-radius:10px; margin:12px 0;}
  </style>
</head>
<body>
  <h1>Admin — Review Replies</h1>

  <div id="authBox">
    <input id="email" value="simeonkonteh@gmail.com" />
    <input id="pass" type="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
    <p id="authMsg"></p>
  </div>

  <div id="app" style="display:none;">
    <button id="logoutBtn">Logout</button>
    <div id="list"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBW3FSeWel6Vm2L0Bz9U1nKVHxRwty4dlY",
      authDomain: "flutter-ai-playground-a5caa.firebaseapp.com",
      projectId: "flutter-ai-playground-a5caa",
      storageBucket: "flutter-ai-playground-a5caa.firebasestorage.app",
      messagingSenderId: "854480872718",
      appId: "1:854480872718:web:d3203732a8900a3a5f235f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const authBox = document.getElementById("authBox");
    const app = document.getElementById("app");
    const list = document.getElementById("list");
    const authMsg = document.getElementById("authMsg");

    document.getElementById("loginBtn").onclick = async () => {
      authMsg.textContent = "Signing in...";
      try{
        await auth.signInWithEmailAndPassword(
          document.getElementById("email").value,
          document.getElementById("pass").value
        );
      } catch {
        authMsg.textContent = "Login failed";
      }
    };

    document.getElementById("logoutBtn").onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if(user){
        authBox.style.display = "none";
        app.style.display = "block";
        loadReviews();
      } else {
        authBox.style.display = "block";
        app.style.display = "none";
      }
    });

    function loadReviews(){
      db.collection("reviews").orderBy("createdAt","desc").onSnapshot(snap=>{
        list.innerHTML = "";
        snap.forEach(doc=>{
          const r = doc.data();
          const div = document.createElement("div");
          div.className = "row";
          div.innerHTML = `
            <p><strong>${r.name}</strong> — ${r.location || ""}</p>
            <p>“${r.text}”</p>
            <textarea id="reply_${doc.id}" rows="3">${r.replyText || ""}</textarea>
            <button data-id="${doc.id}">Save Reply</button>
          `;
          div.querySelector("button").onclick = async e=>{
            const id = e.target.dataset.id;
            const replyText = document.getElementById("reply_"+id).value;
            await db.collection("reviews").doc(id).update({ replyText });
            e.target.textContent = "Saved ✅";
            setTimeout(()=>e.target.textContent="Save Reply",1000);
          };
          list.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>


